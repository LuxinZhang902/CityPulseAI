# üìä Getting Real-Time Data for CityPulse AI

## ‚ö†Ô∏è Important: No Data Will Show Without Real-Time Sync

**CityPulse AI requires real-time data to function properly.** When you first start the application, you may see no data or empty results. This is normal - the system needs to fetch fresh data from San Francisco's open data APIs.

---

## üöÄ Quick Data Setup

### Step 1: Sync Real-Time Data

```bash
# Navigate to project root
cd CityPulseAI_20251212

# Install Python dependencies
pip install -r backend/requirements.txt

# Fetch fresh data from SF Open Data APIs
python scripts/sync_realtime_data.py
```

### Step 2: Upload Database to SnowLeopard

```bash
# After syncing, upload the database to SnowLeopard Playground
# File: synced_citypulse_for_playground.db
# URL: https://playground.snowleopard.ai

# Get the new datafile ID and update your .env file:
# SNOWLEOPARD_DATAFILE_ID=your_new_datafile_id_here
```

### Step 3: Start the Application

```bash
# Start backend
cd backend
python main_integrated.py

# Start frontend (in another terminal)
cd frontend
npm start
```

---

## üì° Data Sources

The system syncs data from these official sources:

### 1. **San Francisco Police Department**
- **Source**: https://data.sfgov.org/Public-Safety/Police-Department-Calls-for-Service/tmnf-yvry
- **Data**: Real-time 911 police dispatch calls
- **Time Range**: Last 24 hours
- **Records**: Up to 1000 incidents

### 2. **San Francisco Fire Department**
- **Source**: https://data.sfgov.org/Public-Safety/Fire-Department-Calls-for-Service/nuek-vuh3
- **Data**: Fire and EMS emergency calls
- **Time Range**: Last 24 hours
- **Records**: Up to 1000 incidents

### 3. **San Francisco 311 Services**
- **Source**: https://data.sfgov.org/City-Infrastructure-and-Services/311-Cases/vw6y-z8j6
- **Data**: Non-emergency city service requests
- **Time Range**: Last 7 days
- **Records**: Infrastructure and social complaints

### 4. **USGS Earthquake Monitoring**
- **Source**: https://earthquake.usgs.gov/fdsnws/event/1/
- **Data**: Seismic events
- **Time Range**: Last 24 hours
- **Radius**: 100km from San Francisco
- **Records**: Typically 0-10 events

---

## üîÑ What Happens During Data Sync

When you run `python scripts/sync_realtime_data.py`:

1. **API Calls**: Makes requests to all 4 data sources
2. **Data Processing**: Cleans and standardizes the data
3. **Database Update**: Replaces sample data with real data
4. **Geocoding**: Adds latitude/longitude for mapping
5. **Neighborhood Assignment**: Maps incidents to SF neighborhoods

### Expected Sync Time:
- **Total**: 30-60 seconds
- **Police Data**: 10-15 seconds
- **Fire/EMS Data**: 10-15 seconds
- **311 Data**: 10-20 seconds
- **Earthquake Data**: 5 seconds

---

## üêõ Troubleshooting: No Data Showing

### Problem: Empty maps or "No data found" messages

**Solution 1: Sync Real-Time Data**
```bash
python scripts/sync_realtime_data.py
```

**Solution 2: Check Database**
```bash
# Verify database exists and has data
ls -la synced_citypulse_for_playground.db
sqlite3 synced_citypulse_for_playground.db "SELECT COUNT(*) FROM sf_police_calls_rt;"
```

**Solution 3: Upload Fresh Database to SnowLeopard**
```bash
# Upload synced_citypulse_for_playground.db to SnowLeopard Playground
# Update .env with new datafile ID
```

**Solution 4: Regenerate Database**
```bash
# Complete database reset
./scripts/regenerate_database.sh
python scripts/sync_realtime_data.py
```

---

## üìä Data Schema After Sync

### Real-Time Tables:
- `sf_police_calls_rt` - Live 911 dispatch calls
- `sf_fire_ems_calls` - Live fire/EMS incidents  
- `sf_311_cases` - Recent 311 service requests
- `sf_disaster_events` - Recent earthquakes/fires/hazmat

### Static Tables:
- `sf_shelter_waitlist` - Shelter demand data
- `sf_homeless_baseline` - Baseline homeless counts
- `neighborhoods` - SF neighborhood boundaries

---

## ‚ö° Automation Options

### Option 1: Sync on Backend Startup
Add to `.env`:
```bash
SYNC_REALTIME_DATA=true
```

### Option 2: Scheduled Sync
```bash
# Run sync every hour
crontab -e
# Add: 0 * * * * cd /path/to/CityPulseAI_20251212 && python scripts/sync_realtime_data.py
```

### Option 3: Manual Sync Before Demo
```bash
# Recommended for hackathon demos
python scripts/sync_realtime_data.py
```

---

## üéØ Demo Tips

1. **Always sync data before demoing**: `python scripts/sync_realtime_data.py`
2. **Upload fresh database** to SnowLeopard for best results
3. **Test with real queries** like:
   - "Show me police incidents in the last 24 hours"
   - "Which neighborhoods have the most emergency calls?"
   - "Generate insurance risk analysis for Mission District"

---

## üìû Data Issues?

If data sync fails:

1. **Check internet connection**
2. **Verify API endpoints are accessible** (try opening the source URLs in browser)
3. **Check rate limits** (SF APIs may limit requests)
4. **Wait a few minutes** and try again
5. **Use sample data** as fallback (already in database)

---

**üîÑ Remember: CityPulse AI is designed for real-time intelligence. Fresh data = better insights!**
